% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/procrustes_alignment.R
\name{perform_gpa_refinement}
\alias{perform_gpa_refinement}
\title{Perform Generalized Procrustes Analysis (GPA) refinement iterations}
\usage{
perform_gpa_refinement(
  A_originals_list,
  n_refine,
  k,
  m_parcel_rows = NULL,
  m_task_rows = 0,
  omega_mode = "fixed",
  fixed_omega_weights = NULL,
  reliability_scores_list = NULL,
  scale_omega_trace = TRUE
)
}
\arguments{
\item{A_originals_list}{List of `(m_parcels + m_tasks) x k` anchor matrices for `N` subjects.}

\item{n_refine}{Integer, number of refinement iterations.}

\item{k}{Integer, spectral rank (number of columns in anchor matrices).}

\item{m_parcel_rows}{Integer, number of rows corresponding to parcel anchors.
Required if `m_task_rows > 0` for weighted Procrustes.}

\item{m_task_rows}{Integer, number of rows corresponding to task anchors. Default 0.
If > 0, `solve_procrustes_rotation_weighted` is used.}

\item{omega_mode}{Character string, mode for `solve_procrustes_rotation_weighted`.
Default `"fixed"`. Ignored if `m_task_rows == 0`.}

\item{fixed_omega_weights}{List, weights for `"fixed"` mode. Passed to weighted solver.
Default `list(parcel = 1.0, condition = 0.5)` is handled by the weighted solver if NULL.}

\item{reliability_scores_list}{List (parallel to `A_originals_list`), each element a
numeric vector of reliability scores for task anchors. Used if `omega_mode == "adaptive"`
and `m_task_rows > 0`. If `NULL`, adaptive mode in solver may use default behavior.}

\item{scale_omega_trace}{Logical, passed to weighted solver. Default `TRUE`.}
}
\value{
List: `R_final_list` (list of `k x k` rotation matrices),
        `T_anchor_final` (final `(m_parcels+m_tasks) x k` group anchor template).
}
\description{
Iteratively refines subject rotations and a group anchor template.
Can use weighted Procrustes if task rows are present and omega_mode is specified.
If n_refine = 0, computes initial rotations against the mean template but does not update the template.
}
\keyword{internal}
