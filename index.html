<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hyperalignment via Task-informed Shared Analysis • hatsa</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Hyperalignment via Task-informed Shared Analysis">
<meta name="description" content="Implements advanced hyperalignment methods for functional neuroimaging data with task-informed features. Provides sparse graph-based alignment of functional connectivity patterns across subjects using spectral decomposition and Procrustes alignment. Includes extensions for task-informed alignment, Riemannian geometry operations on SPD manifolds, and voxel-level projection via Nyström extension.">
<meta property="og:description" content="Implements advanced hyperalignment methods for functional neuroimaging data with task-informed features. Provides sparse graph-based alignment of functional connectivity patterns across subjects using spectral decomposition and Procrustes alignment. Includes extensions for task-informed alignment, Riemannian geometry operations on SPD manifolds, and voxel-level projection via Nyström extension.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">hatsa</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/core-hatsa-toy-example.html">Core HATSA with a Toy-Connectome</a></li>
    <li><a class="dropdown-item" href="articles/getting-started.html">Getting Started with HATSA</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/hatsa/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="hatsa-hyperalignment-via-task-informed-shared-analysis">HATSA: Hyperalignment via Task-informed Shared Analysis<a class="anchor" aria-label="anchor" href="#hatsa-hyperalignment-via-task-informed-shared-analysis"></a>
</h1></div>
<p><a href="https://github.com/bbuchsbaum/hatsa/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/bbuchsbaum/hatsa/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a> <a href="https://app.codecov.io/gh/bbuchsbaum/hatsa?branch=main" class="external-link"><img src="https://codecov.io/gh/bbuchsbaum/hatsa/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>HATSA (Hyperalignment via Task-informed Shared Analysis) is an R package that implements advanced methods for aligning functional neuroimaging data across subjects. The package addresses the fundamental challenge in functional neuroimaging of establishing correspondence between brain regions across individuals, enabling group-level analyses while preserving subject-specific functional organization.</p>
<p>The core innovation of HATSA lies in its integration of task-informed features with graph-based spectral alignment, providing a principled approach to functional hyperalignment that leverages both resting-state connectivity and task-evoked activation patterns.</p>
</div>
<div class="section level2">
<h2 id="key-features">Key Features<a class="anchor" aria-label="anchor" href="#key-features"></a>
</h2>
<div class="section level3">
<h3 id="core-hatsa-algorithm">Core HATSA Algorithm<a class="anchor" aria-label="anchor" href="#core-hatsa-algorithm"></a>
</h3>
<ul>
<li>
<strong>Sparse graph-based alignment</strong> using spectral decomposition of connectivity Laplacians</li>
<li>
<strong>Generalized Procrustes Analysis (GPA)</strong> for optimal orthogonal transformations</li>
<li>
<strong>Anchor-based alignment</strong> ensuring robust correspondence across subjects</li>
<li>
<strong>SO(k) manifold operations</strong> with geodesic distance computations</li>
</ul>
</div>
<div class="section level3">
<h3 id="task-informed-extensions">Task-informed Extensions<a class="anchor" aria-label="anchor" href="#task-informed-extensions"></a>
</h3>
<ul>
<li>
<strong>Lambda blending</strong>: Weighted combination of connectivity and task-activation graphs</li>
<li>
<strong>GEV patches</strong>: Generalized eigenvalue-based incorporation of task information</li>
<li>
<strong>Residualization methods</strong> for handling redundancy between connectivity and task features</li>
</ul>
</div>
<div class="section level3">
<h3 id="advanced-capabilities">Advanced Capabilities<a class="anchor" aria-label="anchor" href="#advanced-capabilities"></a>
</h3>
<ul>
<li>
<strong>Nyström extension</strong> for projecting high-dimensional voxel data</li>
<li>
<strong>Riemannian geometry operations</strong> on symmetric positive definite (SPD) manifolds</li>
<li>
<strong>Quality control metrics</strong> and alignment validation</li>
<li>
<strong>Multivariate projection framework</strong> integration</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from GitHub</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"bbuchsbaum/hatsa"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="section level3">
<h3 id="basic-hatsa-alignment">Basic HATSA Alignment<a class="anchor" aria-label="anchor" href="#basic-hatsa-alignment"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bbuchsbaum.github.io/hatsa/">hatsa</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Core HATSA with automatic parameter selection</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://bbuchsbaum.github.io/hatsa/reference/hatsa-package.html">hatsa</a></span><span class="op">(</span><span class="va">subject_data_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract aligned data and examine results</span></span>
<span><span class="va">aligned_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/hatsa-accessors.html">get_aligned_data</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="task-informed-hatsa">Task-informed HATSA<a class="anchor" aria-label="anchor" href="#task-informed-hatsa"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Task-informed alignment with lambda blending</span></span>
<span><span class="va">task_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/hatsa_task.html">hatsa_task</a></span><span class="op">(</span></span>
<span>  subject_data_list <span class="op">=</span> <span class="va">connectivity_data</span>,</span>
<span>  task_data_list <span class="op">=</span> <span class="va">activation_maps</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"lambda_blend"</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># GEV-based task integration</span></span>
<span><span class="va">gev_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/hatsa_task.html">hatsa_task</a></span><span class="op">(</span></span>
<span>  subject_data_list <span class="op">=</span> <span class="va">connectivity_data</span>,</span>
<span>  task_data_list <span class="op">=</span> <span class="va">activation_maps</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"gev_patch"</span>,</span>
<span>  k_gev_dims <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="advanced-usage">Advanced Usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Detailed control over hyperalignment parameters</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/run_hatsa_core.html">run_hatsa_core</a></span><span class="op">(</span></span>
<span>  subject_data_list <span class="op">=</span> <span class="va">timeseries_data</span>,</span>
<span>  anchor_indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">15</span>, <span class="fl">23</span>, <span class="fl">45</span>, <span class="fl">67</span><span class="op">)</span>,</span>
<span>  spectral_rank_k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  k_conn_pos <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  k_conn_neg <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  n_refine <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Project high-dimensional voxel data</span></span>
<span><span class="va">voxel_projections</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/project_voxels.html">project_voxels</a></span><span class="op">(</span></span>
<span>  <span class="va">result</span>, </span>
<span>  voxel_timeseries_list <span class="op">=</span> <span class="va">voxel_data</span>,</span>
<span>  voxel_coords <span class="op">=</span> <span class="va">voxel_coordinates</span>,</span>
<span>  parcel_coords <span class="op">=</span> <span class="va">parcel_centroids</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="mathematical-foundation">Mathematical Foundation<a class="anchor" aria-label="anchor" href="#mathematical-foundation"></a>
</h2>
<p>HATSA implements a spectral approach to functional alignment based on the eigendecomposition of graph Laplacians derived from functional connectivity. The core algorithm:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Graph Construction</strong>: Builds sparse k-NN graphs from subject-specific connectivity matrices</li>
<li>
<strong>Spectral Decomposition</strong>: Computes low-rank spectral sketches via Laplacian eigendecomposition</li>
<li>
<strong>Anchor Alignment</strong>: Establishes correspondence using anchor parcels across subjects</li>
<li>
<strong>Procrustes Refinement</strong>: Iteratively refines alignment via generalized Procrustes analysis</li>
<li>
<strong>Projection</strong>: Maps data to the common representational space</li>
</ol>
<p>The task-informed extensions incorporate activation patterns through: - <strong>Weighted graph combination</strong> (lambda blending) - <strong>Generalized eigenvalue problems</strong> (GEV patches) - <strong>Manifold-based integration</strong> on SPD matrices</p>
</div>
<div class="section level2">
<h2 id="core-functions">Core Functions<a class="anchor" aria-label="anchor" href="#core-functions"></a>
</h2>
<div class="section level3">
<h3 id="primary-interfaces">Primary Interfaces<a class="anchor" aria-label="anchor" href="#primary-interfaces"></a>
</h3>
<ul>
<li>
<code><a href="https://bbuchsbaum.github.io/hatsa/reference/hatsa-package.html">hatsa()</a></code>: High-level interface for core HATSA alignment</li>
<li>
<code><a href="reference/hatsa_task.html">hatsa_task()</a></code>: Task-informed hyperalignment</li>
<li>
<code><a href="reference/run_hatsa_core.html">run_hatsa_core()</a></code>: Low-level core algorithm control</li>
<li>
<code><a href="reference/task_hatsa.html">run_task_hatsa()</a></code>: Detailed task-informed alignment</li>
</ul>
</div>
<div class="section level3">
<h3 id="spectral-graph-methods">Spectral Graph Methods<a class="anchor" aria-label="anchor" href="#spectral-graph-methods"></a>
</h3>
<ul>
<li>
<code><a href="reference/compute_subject_connectivity_graph_sparse.html">compute_subject_connectivity_graph_sparse()</a></code>: Sparse connectivity graphs</li>
<li>
<code><a href="reference/compute_graph_laplacian_sparse.html">compute_graph_laplacian_sparse()</a></code>: Laplacian computation</li>
<li>
<code><a href="reference/compute_spectral_sketch_sparse.html">compute_spectral_sketch_sparse()</a></code>: Eigendecomposition</li>
<li>
<code><a href="reference/solve_gev_laplacian_primme.html">solve_gev_laplacian_primme()</a></code>: Generalized eigenvalue solver</li>
</ul>
</div>
<div class="section level3">
<h3 id="alignment-and-projection">Alignment and Projection<a class="anchor" aria-label="anchor" href="#alignment-and-projection"></a>
</h3>
<ul>
<li>
<code><a href="reference/solve_procrustes_rotation.html">solve_procrustes_rotation()</a></code>: Orthogonal alignment</li>
<li>
<code><a href="reference/project_voxels.html">project_voxels()</a></code>: Nyström extension for voxel projection</li>
<li>
<code><a href="reference/misalign_deg.html">misalign_deg()</a></code>: SO(k) geodesic distances</li>
</ul>
</div>
<div class="section level3">
<h3 id="quality-control">Quality Control<a class="anchor" aria-label="anchor" href="#quality-control"></a>
</h3>
<ul>
<li>
<code><a href="reference/hatsa_summary.html">hatsa_summary()</a></code>: Alignment quality metrics</li>
<li>
<code><a href="reference/plot_hatsa.html">plot_hatsa()</a></code>: Visualization methods</li>
<li>
<code><a href="reference/reconstruction_error.html">reconstruction_error()</a></code>: Validation metrics</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h2>
<div class="section level3">
<h3 id="required">Required<a class="anchor" aria-label="anchor" href="#required"></a>
</h3>
<ul>
<li>
<code>Matrix</code>: Sparse matrix operations</li>
<li>
<code>PRIMME</code>: Generalized eigenvalue problems</li>
<li>
<code>expm</code>: Matrix exponential/logarithm operations</li>
<li>
<code>multivarious</code>: S3 projector framework</li>
<li>
<code>RANN</code>: Fast nearest neighbor search</li>
</ul>
</div>
<div class="section level3">
<h3 id="suggested">Suggested<a class="anchor" aria-label="anchor" href="#suggested"></a>
</h3>
<ul>
<li>
<code>vegan</code>: Procrustes analysis</li>
<li>
<code>ggplot2</code>: Visualization</li>
<li>
<code>testthat</code>: Testing framework</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="mathematical-details">Mathematical Details<a class="anchor" aria-label="anchor" href="#mathematical-details"></a>
</h2>
<p>The package implements computations on several mathematical structures:</p>
<ul>
<li>
<strong>Special Orthogonal Group SO(k)</strong>: Rotation matrices with geodesic distance metrics</li>
<li>
<strong>SPD Manifolds</strong>: Riemannian operations on positive definite matrices<br>
</li>
<li>
<strong>Graph Laplacians</strong>: Spectral graph theory for connectivity analysis</li>
<li>
<strong>Stiefel Manifolds</strong>: Orthogonal matrix optimization via Procrustes methods</li>
</ul>
<p>Numerical stability is ensured through: - Eigenvalue tolerance checking - SVD-based orthogonalization - Condition number monitoring - Robust matrix logarithms</p>
</div>
<div class="section level2">
<h2 id="citations">Citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h2>
<p>When using HATSA in your research, please cite:</p>
<pre><code>Buchsbaum, B.R. (2024). HATSA: Hyperalignment via Task-informed Shared Analysis.
R package version 0.1.0. https://github.com/bbuchsbaum/hatsa</code></pre>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT License - See LICENSE file for details.</p>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>Contributions are welcome! Please see <a href="CONTRIBUTING.html">CONTRIBUTING.md</a> for guidelines.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/bbuchsbaum/hatsa/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/bbuchsbaum/hatsa/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing hatsa</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Brad Buchsbaum <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brad Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
