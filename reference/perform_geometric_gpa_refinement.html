<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Perform Geometric Generalized Procrustes Analysis (Geo-GPA) on SO(k) — perform_geometric_gpa_refinement • hatsa</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Perform Geometric Generalized Procrustes Analysis (Geo-GPA) on SO(k) — perform_geometric_gpa_refinement"><meta name="description" content="Refines a set of rotation matrices and a group anchor template using either
an SVD-based iterative Procrustes approach (default) or a variant where the
template update is oriented by the Frechet mean of rotations.
The SVD mode minimizes the Frobenius distance between rotated subject anchors
and the template. The Riemannian mode aims to make the template's orientation
consistent with the Frechet mean of subject rotations, which implicitly relates
to minimizing intrinsic SO(k) geodesic distances for the rotations' central tendency."><meta property="og:description" content="Refines a set of rotation matrices and a group anchor template using either
an SVD-based iterative Procrustes approach (default) or a variant where the
template update is oriented by the Frechet mean of rotations.
The SVD mode minimizes the Frobenius distance between rotated subject anchors
and the template. The Riemannian mode aims to make the template's orientation
consistent with the Frechet mean of subject rotations, which implicitly relates
to minimizing intrinsic SO(k) geodesic distances for the rotations' central tendency."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hatsa</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/core-hatsa-toy-example.html">Core HATSA with a Toy-Connectome</a></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started with HATSA</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bbuchsbaum/hatsa/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Perform Geometric Generalized Procrustes Analysis (Geo-GPA) on SO(k)</h1>
      <small class="dont-index">Source: <a href="https://github.com/bbuchsbaum/hatsa/blob/main/R/procrustes_alignment.R" class="external-link"><code>R/procrustes_alignment.R</code></a></small>
      <div class="d-none name"><code>perform_geometric_gpa_refinement.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Refines a set of rotation matrices and a group anchor template using either
an SVD-based iterative Procrustes approach (default) or a variant where the
template update is oriented by the Frechet mean of rotations.
The SVD mode minimizes the Frobenius distance between rotated subject anchors
and the template. The Riemannian mode aims to make the template's orientation
consistent with the Frechet mean of subject rotations, which implicitly relates
to minimizing intrinsic SO(k) geodesic distances for the rotations' central tendency.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">perform_geometric_gpa_refinement</span><span class="op">(</span></span>
<span>  <span class="va">A_originals_list</span>,</span>
<span>  n_refine <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  <span class="va">k</span>,</span>
<span>  <span class="va">m_rows</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-07</span>,</span>
<span>  rotation_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"svd"</span>, <span class="st">"riemannian"</span><span class="op">)</span>,</span>
<span>  frechet_mean_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  initial_R_list <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-a-originals-list">A_originals_list<a class="anchor" aria-label="anchor" href="#arg-a-originals-list"></a></dt>
<dd><p>A list of subject-specific anchor matrices (m_rows x k).
Each matrix `A_i` contains the rows from `U_original_list[[i]]` corresponding
to the `unique_anchor_indices`.</p></dd>


<dt id="arg-n-refine">n_refine<a class="anchor" aria-label="anchor" href="#arg-n-refine"></a></dt>
<dd><p>Integer, number of GPA refinement iterations. Default: 10.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Integer, the dimensionality of the sketch space (number of columns in A_i and R_i).</p></dd>


<dt id="arg-m-rows">m_rows<a class="anchor" aria-label="anchor" href="#arg-m-rows"></a></dt>
<dd><p>Integer, number of anchor features (number of rows in A_i).</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>Numeric, tolerance for convergence based on the relative Frobenius norm
change in the template `T_template`. Default: 1e-7.</p></dd>


<dt id="arg-rotation-mode">rotation_mode<a class="anchor" aria-label="anchor" href="#arg-rotation-mode"></a></dt>
<dd><p>Character string, one of `"svd"` (default) or `"riemannian"`.
- `"svd"`: Uses SVD to find the closest SO(k) rotation for each subject to align
  `A_i` with `T_template`. `T_template` is the Euclidean mean of `A_i R_i`.
  This mode minimizes the sum of squared Frobenius distances `sum(||A_i R_i - T||_F^2)`.
- `"riemannian"`: Individual rotations `R_i` are updated as in `"svd"` mode.
  However, `T_template` is updated by first computing the Frechet mean (`R_bar`)
  of the current `R_list`, then averaging `A_i R_i R_bar^T` (configurations aligned
  to `R_bar`'s frame), and finally rotating this average back by `R_bar`.
  This mode seeks to make the template orientation consistent with the intrinsic
  mean of the rotation ensemble.</p></dd>


<dt id="arg-frechet-mean-options">frechet_mean_options<a class="anchor" aria-label="anchor" href="#arg-frechet-mean-options"></a></dt>
<dd><p>A list of options to pass to `hatsa::frechet_mean_so_k`,
used if `rotation_mode = "riemannian"` or for the final `R_bar_final` computation.
Example: `list(max_iter = 20, tol = 1e-5)`. Defaults are used if not provided.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, if TRUE, prints progress messages. Default TRUE.</p></dd>


<dt id="arg-initial-r-list">initial_R_list<a class="anchor" aria-label="anchor" href="#arg-initial-r-list"></a></dt>
<dd><p>Optional list of initial k x k rotation matrices. If NULL,
identity matrices are used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing:
  - `R_final_list`: List of final subject-specific rotation matrices (k x k).
  - `T_anchor_final`: The final group anchor template matrix (m_rows x k).
  - `R_bar_final`: The Fréchet mean of the final `R_final_list`.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Matrices in `A_originals_list` are checked to be numeric and to have
dimensions `m_rows x k` before the initial template is computed.
Invalid matrices are ignored with their indices reported in a warning.
If all matrices are invalid, the function returns identity rotations and an
`NA` template rather than stopping with an error.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brad Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

